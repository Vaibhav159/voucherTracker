/**
 * VoucherTracker Mobile Fixes - COMPREHENSIVE
 * 
 * Fixes for:
 * 1. QuickCardPicker FAB overlap (CRITICAL)
 * 2. Credit Card Comparison Table overflow
 * 3. Banking Tiers Comparison Table overflow
 * 4. Floating Compare Bar overlap
 * 5. VoucherModal layout issues
 * 6. Banking Compare Bar overlap
 */

/* ============================================
   CRITICAL: QUICKCARDPICKER FAB FIX
   The blue circular button that overlaps content
   ============================================ */

@media (max-width: 768px) {

  .quick-card-picker-fab,
  button[aria-label="Quick Card Picker"] {
    bottom: 140px !important;
    left: 16px !important;
    right: auto !important;
    width: 48px !important;
    height: 48px !important;
    font-size: 1.2rem !important;
    z-index: 900 !important;
    /* Lower than modals (9999) and sidebar (1000) */
  }

  /* Hide FAB when modal is open */
  body:has(.modal-overlay) .quick-card-picker-fab,
  body:has(.modal-overlay) button[aria-label="Quick Card Picker"],
  body:has(.guide-modal-overlay) .quick-card-picker-fab,
  body:has(.guide-modal-overlay) button[aria-label="Quick Card Picker"],
  body:has(.banking-compare-modal-overlay) .quick-card-picker-fab,
  body:has(.banking-compare-modal-overlay) button[aria-label="Quick Card Picker"] {
    display: none !important;
  }

  /* Hide FAB when sidebar/menu is open */
  body.menu-open .quick-card-picker-fab,
  body.menu-open button[aria-label="Quick Card Picker"],
  body.sidebar-open .quick-card-picker-fab,
  body.sidebar-open button[aria-label="Quick Card Picker"] {
    display: none !important;
  }

  /* Hide FAB when body overflow is hidden (modal open) - broader compatibility */
  body[style*="overflow: hidden"] .quick-card-picker-fab,
  body[style*="overflow: hidden"] button[aria-label="Quick Card Picker"],
  body[style*="overflow:hidden"] .quick-card-picker-fab,
  body[style*="overflow:hidden"] button[aria-label="Quick Card Picker"] {
    display: none !important;
  }

  /* Ensure mobile overlay covers everything */
  .mobile-overlay {
    z-index: 1050 !important;
  }

  .mobile-overlay.active {
    background: rgba(0, 0, 0, 0.8) !important;
  }

  /* Sidebar must be above overlay */
  .nav-mobile,
  .nav-mobile.open {
    z-index: 1051 !important;
    background: rgba(15, 15, 25, 0.99) !important;
  }
}

/* ============================================
   VOUCHER MODAL - BOTTOM SHEET ON MOBILE
   ============================================ */

@media (max-width: 768px) {
  .modal-overlay {
    padding: 0 !important;
    align-items: flex-end !important;
    background: rgba(0, 0, 0, 0.85) !important;
    backdrop-filter: blur(8px) !important;
    z-index: 9999 !important;
  }

  .modal-container,
  .modal-container.glass-panel {
    width: 100% !important;
    max-width: 100% !important;
    max-height: 85vh !important;
    border-radius: 24px 24px 0 0 !important;
    margin: 0 !important;
    animation: slideUpModal 0.3s cubic-bezier(0.16, 1, 0.3, 1) !important;
    border: 1px solid rgba(255, 255, 255, 0.1) !important;
    border-bottom: none !important;
    box-shadow: 0 -10px 40px rgba(0, 0, 0, 0.5) !important;
    background: #13131f !important;
    /* Solid dark background */
  }

  .modal-header {
    padding: 1rem !important;
    gap: 0.75rem !important;
    flex-wrap: wrap !important;
    position: relative !important;
  }

  .modal-header__logo {
    width: 48px !important;
    height: 48px !important;
    flex-shrink: 0 !important;
  }

  .modal-header__logo img {
    width: 100% !important;
    height: 100% !important;
    object-fit: contain !important;
  }

  .modal-header__info {
    flex: 1 !important;
    min-width: 0 !important;
    max-width: calc(100% - 120px) !important;
  }

  .modal-header__title {
    font-size: 1rem !important;
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
  }

  .modal-header__tag {
    font-size: 0.7rem !important;
    padding: 2px 8px !important;
  }

  /* Action buttons in header */
  .modal-header>div:last-child {
    display: flex !important;
    gap: 6px !important;
    flex-shrink: 0 !important;
  }

  .modal-header button,
  .modal-header a {
    padding: 6px 10px !important;
    font-size: 0.75rem !important;
  }

  .btn-close {
    width: 32px !important;
    height: 32px !important;
    font-size: 1.2rem !important;
  }

  /* Hide desktop text, show mobile text */
  .btn-text-desktop {
    display: none !important;
  }

  .btn-text-mobile {
    display: inline !important;
  }

  .modal-content {
    padding: 0 1rem 1rem !important;
    max-height: calc(90vh - 120px) !important;
    overflow-y: auto !important;
    -webkit-overflow-scrolling: touch !important;
  }

  .modal-section-header {
    padding: 0.75rem 0 !important;
    font-size: 0.75rem !important;
  }

  /* Platform offer cards */
  .platform-offer {
    padding: 1rem !important;
    margin-bottom: 0.75rem !important;
  }

  .platform-offer__header {
    flex-wrap: wrap !important;
    gap: 0.75rem !important;
  }

  .platform-offer__logo {
    width: 48px !important;
    height: 48px !important;
  }

  .platform-offer__details {
    flex: 1 !important;
    min-width: 120px !important;
  }

  .platform-offer__metric {
    flex: 1 !important;
    min-width: 80px !important;
  }

  .platform-offer__metric-label {
    font-size: 0.65rem !important;
  }

  .platform-offer__metric-value {
    font-size: 0.9rem !important;
  }

  .platform-offer__footer {
    flex-direction: column !important;
    gap: 0.75rem !important;
    margin-top: 0.75rem !important;
    padding-top: 0.75rem !important;
  }

  .platform-offer__footer>div {
    width: 100% !important;
  }

  .platform-offer__denominations {
    justify-content: flex-start !important;
    flex-wrap: wrap !important;
    gap: 4px !important;
  }

  .denomination-badge {
    font-size: 0.7rem !important;
    padding: 2px 6px !important;
  }

  /* Buy buttons row */
  .platform-offer__footer>div:last-child {
    display: flex !important;
    gap: 8px !important;
    width: 100% !important;
  }

  .platform-offer__footer button,
  .platform-offer__footer a {
    flex: 1 !important;
    justify-content: center !important;
    padding: 10px 12px !important;
    font-size: 0.8rem !important;
    text-align: center !important;
  }

  /* Info card tip */
  .info-card {
    padding: 0.75rem !important;
    margin-top: 1rem !important;
  }

  .info-card__icon {
    font-size: 1.2rem !important;
  }

  .info-card__title {
    font-size: 0.85rem !important;
  }

  .info-card__description {
    font-size: 0.8rem !important;
  }

  @keyframes slideUpModal {
    from {
      opacity: 0;
      transform: translateY(100%);
    }

    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
}

/* ============================================
   COMPARISON TABLE FIXES
   ============================================ */

@media (max-width: 768px) {
  .comparison-table-wrapper {
    overflow-x: auto !important;
    -webkit-overflow-scrolling: touch !important;
    max-width: 100vw !important;
    margin: 0 -1rem !important;
    padding: 0 1rem !important;
    scrollbar-width: thin !important;
  }

  .comparison-table-wrapper table {
    min-width: max-content !important;
  }

  /* Sticky first column */
  .comparison-table-wrapper td:first-child,
  .comparison-table-wrapper th:first-child {
    position: sticky !important;
    left: 0 !important;
    z-index: 15 !important;
    background: rgba(13, 13, 25, 0.98) !important;
    min-width: 75px !important;
    max-width: 90px !important;
  }

  .comparison-table-wrapper .glass-sticky-header {
    position: sticky !important;
    top: 0 !important;
    z-index: 20 !important;
  }

  .comparison-table-wrapper th:first-child.glass-sticky-header {
    z-index: 30 !important;
  }

  /* Card columns */
  .comparison-table-wrapper th:not(:first-child),
  .comparison-table-wrapper td:not(:first-child) {
    min-width: 130px !important;
    max-width: 150px !important;
  }

  .liquid-glass {
    overflow: hidden !important;
    max-width: 100% !important;
  }
}

/* ============================================
   FLOATING COMPARE BARS - RAISED POSITION
   ============================================ */

@media (max-width: 768px) {

  /* Credit Card floating compare bar */
  .floating-compare-bar {
    bottom: 80px !important;
    left: 1rem !important;
    right: 1rem !important;
    transform: none !important;
    max-width: calc(100vw - 2rem) !important;
    padding: 10px 14px !important;
    border-radius: 12px !important;
    flex-wrap: wrap !important;
    justify-content: center !important;
    gap: 8px !important;
    z-index: 997 !important;
  }

  .floating-compare-bar span {
    font-size: 0.8rem !important;
  }

  .floating-compare-bar a,
  .floating-compare-bar button {
    font-size: 0.8rem !important;
    padding: 8px 12px !important;
  }

  /* Banking compare bar */
  .banking-compare-bar {
    bottom: 80px !important;
    left: 0 !important;
    right: 0 !important;
    padding: 0.75rem 1rem !important;
    flex-direction: column !important;
    gap: 0.75rem !important;
    z-index: 997 !important;
  }

  .banking-compare-bar .compare-items {
    flex-wrap: wrap !important;
    justify-content: center !important;
    gap: 0.5rem !important;
  }

  .banking-compare-bar .compare-chip {
    padding: 4px 10px !important;
    font-size: 0.75rem !important;
  }

  .banking-compare-bar .compare-chip .bank-name {
    display: none !important;
  }

  .banking-compare-bar .compare-actions {
    width: 100% !important;
    justify-content: center !important;
    gap: 0.5rem !important;
  }

  .banking-compare-bar .compare-btn {
    padding: 8px 14px !important;
    font-size: 0.8rem !important;
    flex: 1 !important;
    max-width: 150px !important;
  }
}

/* ============================================
   BANKING COMPARE MODAL
   ============================================ */

@media (max-width: 768px) {
  .banking-compare-modal-overlay {
    padding: 0 !important;
    align-items: flex-end !important;
  }

  .banking-compare-modal {
    width: 100% !important;
    max-width: 100% !important;
    max-height: 95vh !important;
    border-radius: 20px 20px 0 0 !important;
    margin: 0 !important;
  }

  .banking-compare-modal-content {
    max-height: calc(95vh - 80px) !important;
    overflow-y: auto !important;
    -webkit-overflow-scrolling: touch !important;
    padding: 1rem !important;
  }

  .banking-compare-grid {
    display: flex !important;
    flex-direction: column !important;
    gap: 1rem !important;
  }

  .banking-compare-column {
    width: 100% !important;
    min-width: unset !important;
  }
}

/* ============================================
   GENERAL OVERFLOW PREVENTION
   ============================================ */

@media (max-width: 768px) {

  html {
    overflow-x: hidden !important;
    max-width: 100vw !important;
  }

  body {
    overflow: visible !important;
    max-width: 100vw !important;
  }

  .glass-panel {
    max-width: 100% !important;
  }

  table {
    display: block;
    max-width: 100%;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }
}

/* ============================================
   CONTENT PADDING FOR FAB/NAV CLEARANCE
   ============================================ */

@media (max-width: 768px) {
  main {
    padding-bottom: 100px !important;
  }

  .home-container main {
    padding-bottom: 100px !important;
  }

  .credit-card-grid,
  .tier-grid,
  .voucher-grid {
    padding-bottom: 120px !important;
  }

  .credit-card-comparison-page,
  .banking-guides-page,
  [class*="comparison"] {
    padding-bottom: 140px !important;
  }
}

/* ============================================
   TOUCH-FRIENDLY IMPROVEMENTS
   ============================================ */

@media (max-width: 768px) {

  .tier-compare-checkbox,
  [class*="compare-checkbox"] {
    min-height: 44px !important;
    min-width: 44px !important;
    padding: 10px 16px !important;
  }

  button,
  a {
    min-height: 44px;
  }

  .compare-chip .remove-btn,
  button[title="Remove from comparison"] {
    min-width: 32px !important;
    min-height: 32px !important;
  }
}

/* ============================================
   HIDE DESKTOP ELEMENTS ON MOBILE
   ============================================ */

@media (max-width: 768px) {
  .desktop-only {
    display: none !important;
  }
}

@media (min-width: 769px) {
  .mobile-only {
    display: none !important;
  }

  .btn-text-mobile {
    display: none !important;
  }

  .btn-text-desktop {
    display: inline !important;
  }
}